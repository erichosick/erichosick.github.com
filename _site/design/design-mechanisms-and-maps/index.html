
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Mechanisms and Maps</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Maps are implement using emitters.">
    <meta name="author" content="Eric Hosick">

    <meta property="og:title" content="Eric Hosick" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="http://www.erichosick.com/assets/img/eric_hosick.jpg"/> 
    <meta property="og:description" content="Eric Hosick's personal blog page and stuff."/>
    <meta property="fb:admins" content="erichosick" />

    <link href='//netdna.bootstrapcdn.com/twitter-bootstrap/2.1.1/css/bootstrap-combined.min.css' rel='stylesheet'>    
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="http://fonts.googleapis.com/css?family=Pontano+Sans" rel="stylesheet" type="text/css">

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>


    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="http://www.erichosick.com"><img src="/assets/img/logoRuby.png"></img></a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li><a href="/index.html">Home</a></li>
              <li><a href="/categories.html">Categories</a></li>
              <li><a href="/pages.html">Pages</a></li>
              <li><a href="/tags.html">Tags</a></li>
            </ul>
            <p class="pull-right">
              <a class="nav-a-social" href="https://plus.google.com/101227313031284036080/posts" target="_blank"><i class="icon-google-color icon-social"></i></a>
              <a class="nav-a-social" href="http://www.twitter.com/erichosick" target="_blank"><i class="icon-twitter-color icon-social"></i></a>
              <a class="nav-a-social" href="mailto:erichosick@gmail.com"><i class="icon-mail-color icon-social"></i></a>
            </p>
          </div>
        </div>
      </div>
    </div>    

    <div class="container-fluid container-main">
      
<div class="row-fluid">
  <div class="span3">
    <div class="well sidebar-nav">
  <ul class="nav nav-list">
    <li class="nav-header">About</li>
    <li><img src="/assets/img/eric_hosick.jpg" class="img-rounded"></li>
    <li> <a href="http://www.erichosick.com">Eric Hosick</a><p class="nav-about">Creator of Interface Vision, NoMethods, Agile enthusiast, entrepreneur, founder, BDD advocate, lecturer, technologist, developer, scrum master and book writer.</p></li>
    <li><p><a href="http://twitter.com/erichosick" target="_blank">erichosick@gmail.com</a></p></li>
  </ul>
</div>

    
    <div class="well sidebar-nav">
      <ul class="nav nav-list">
        <li class="nav-header">Tags</li>
        
        


  
     
    	<li><a href="/tags.html#Javascript-ref">Javascript <span>3</span></a></li>
     
    	<li><a href="/tags.html#composition-ref">composition <span>6</span></a></li>
     
    	<li><a href="/tags.html#mechanisms-ref">mechanisms <span>3</span></a></li>
     
    	<li><a href="/tags.html#policy-ref">policy <span>2</span></a></li>
     
    	<li><a href="/tags.html#frameworks-ref">frameworks <span>2</span></a></li>
     
    	<li><a href="/tags.html#programming languages-ref">programming languages <span>2</span></a></li>
     
    	<li><a href="/tags.html#maps-ref">maps <span>1</span></a></li>
     
    	<li><a href="/tags.html#emitters-ref">emitters <span>1</span></a></li>
     
    	<li><a href="/tags.html#emit-ref">emit <span>1</span></a></li>
    
  



      </ul>
    </div><!--/.well -->
      
    
  </div>
  <div class="span9">
    <div class="hero-unit">
      <div class="page-header">
        <h1>Mechanisms and Maps</h1>
        <div class="row-fluid">
          <div class="span2">
            <img src="/assets/img/eric_hosick.jpg" class="img-rounded">
          </div>
          <div class="span8">
            <p>by <a href="http://twitter.com/erichosick" target="_blank">Eric Hosick</a> (erichosick@gmail.com)</p>
            <h4>Published <small class="date">15 October 2014</small></h4>
          </div>
        </div>
      </div>
      <script src="/assets/js/mCore.js"></script>

<script src="/assets/js/mWeb.js"></script>

<h2 id="introduction">Introduction</h2>

<p>This is a continuation of the <a href="/design/design-mechanisms-and-policies" title="mechanisms and policies">mechanisms and policies</a> post.</p>

<p>People asked for a less-trivial example on what mechanisms are. In this post, we will show how we can implement <a href="https://github.com/mechanismsjs/mech-math#map-mechanism" title="The map mechanism">mapping</a> using <a href="/design/design-mechanisms-and-policies" title="mechanisms and policies">mechanisms</a> and <a href="https://github.com/mechanismsjs/mech-emit" title="Mechanisms for emitting data">emitters</a>.</p>

<h2 id="map-examples">Map Examples</h2>

<p>Mapping “calls a defined callback function (policy) on each element of an array, and returns an array that contains the results”.”</p>

<p>Traditionally, this is done in Javascript as follows:</p>

<pre><code>// traditional approach
var x = [1, 2, 3, 4, 5].map(
   function(n) {
     return n + 2;
   }
);

// x contains [3, 4, 5, 6, 7]
</code></pre>

<p>Let’s build a policy that does the same thing using a <strong>map</strong> and an <strong>emitter</strong> described in detail below.</p>

<pre><code>// our policy defined with mechanism
var x = m.map(
  m.add(
    2,
    m.emitArr([1,2,3,4,5])
  )
).go;

// x also contains [3, 4, 5, 6, 7]
</code></pre>

<h2 id="pushing-into--vs--pulling-into">Pushing Into -vs- Pulling Into</h2>

<h3 id="push-then-pull-approach">Push-Then-Pull Approach</h3>

<p>Traditionally, we use a <strong>push-then-pull</strong> approach to programming algorithms. We <strong>push</strong> data into the algorithm and <strong>pull</strong> a result.</p>

<p>In the traditional example, we <strong>pushed</strong> a callback-function to the map algorithm. The map algorithm itself <strong>pushes</strong> into the our callback-function the value of the current element. It then <strong>pulls</strong> the result of the call-back function and adds that value to an array that is eventually <strong>pulled</strong> from the map function and placed in the variable <em>x</em>.</p>

<h3 id="pull-approach">Pull Approach</h3>

<p>A pull centric approach has the algorithm <strong>pulling</strong> into itself the information it needs.</p>

<p>Our policy is made up of a <em>map</em>, <em>add</em> and <em>emitArr</em> mechanism. We can plug any policy into our map mechanism. Maybe we just want to <strong>pull</strong> directly from the emitter:</p>

<pre><code>// map simply returns an array
var x = m.map(
  m.emitArr([1, 2, 3, 4, 5])
).go;

// x contains [1, 2, 3, 4, 5]
</code></pre>

<p>or something silly like writing to the console each element we are adding to the map:</p>

<pre><code>// our policy defined with mechanism
var x = m.map(
  m.writeLn(
    m.mul(
      3,
      m.emitRange(1, 3, .5)
    )
  )
).go;

// x contains [3, 4.5, 6, 7.5, 9]
// and we will see 3, 4.5, 6, 7.5 and 9: each written on it's own line
</code></pre>

<p>The point is, we aren’t limited to one kind of thing: a call-back function. It can by any mechanism or any policy.</p>

<p>The map mechanism itself becomes crazy simple and the implementation (<a href="https://github.com/mechanismsjs/mech-math/blob/master/src/map.js">here</a>) is partially provided:</p>

<pre><code>MapF.prototype = Object.create(Object.prototype, {
   go: { get: function() {
      if ( null === this._cache) {
         this._cache = [];
         var cur = this._a.go;
         var i = 0;
         while ((undefined !== cur) &amp;&amp; ( i &lt; this._fixed)) {
            this._cache[i++] = cur;
            cur = this._a.go;
         }
      }
      return this._cache;
   }}
});
</code></pre>

<p>We simply <strong>pull</strong> a result from the policy located in <em>this._a</em>, invoking the policy by accessing go, and add it to an array.</p>

<h2 id="more-examples-of-mapping-with-emitter-mechanisms">More Examples of Mapping with Emitter Mechanisms</h2>

<p>An <a href="https://github.com/mechanismsjs/mech-emit" title="Mechanisms for emitting data">emitter</a> provides the next value. We have created two emitters so far:</p>

<ul>
  <li><strong>emitArr</strong> - An emitter that pulls items from an array (ya - a bad name. emitArrSource maybe?)</li>
  <li><strong>emitRange</strong> - An emitter that pulls items from a dynamically generated range of numbers (ya - a bad name. emitRangeSource maybe?)</li>
</ul>

<p>We can do some cool things with these.</p>

<p>How about:</p>

<pre><code>m.emitRange(0, Infinity, 23); // an unlimited range
m.emitRange(-20, 20, .5); // a simple range
m.emitRange(1, Infinity, 2); // emit odd numbers
m.emitRange(0, Infinity, 2); // emit even numbers
</code></pre>

<p>How about a range that repeats:</p>

<pre><code>m.emitRange(1,3,1,true); // an unlimited range [1,2,3,1,2,3...]
</code></pre>

<p>Let’s add two emitters:</p>

<pre><code>m.add (
  m.emitRange(0, Infinity, 2),
  m.emitRange(1, Infinity, 2)
);
</code></pre>

<p>Let’s map that addition limited to 30 elements:</p>

<pre><code>var x = m.map(
  m.add (
    m.emitRange(0, Infinity, 2),
    m.emitRange(1, Infinity, 2)
  ),
  30
).go;

// [ 1,  5,  9, 13, 17,  21,  25,  29,  33,  37,
//  41, 45, 49, 53, 57,  61,  65,  69,  73,  77,
//  81, 85, 89, 93, 97, 101, 105, 109, 113, 117]
</code></pre>

<h2 id="why-limit-the-size-of-your-maps">WHY LIMIT THE SIZE OF YOUR MAPS?</h2>

<p>Remember that traditionally, somewhere in the program we take the result of our map and stuff it into something else. That something else then does something to that map.</p>

<p>But do we really need such maps anymore? Remember, we can plug our example addition of emitters policy into anything. This means, we can effectively have infinite sized maps.</p>

<p>And by plug into anything, we mean <strong>ANYTHING</strong>.</p>

<p>Even the <em>increment-by</em> argument of an emitter can be an emitter!?!?!</p>

<pre><code>m.emitRange(0, Infinity, m.emitArr([1,-8,3,12]), true));
</code></pre>

<p>This is some strange emitter where we increment by 1, then -8, then 12, then 2 and then repeat (1, -8, 3, 12).</p>

<pre><code>1, -7, -4, 8, 9, 1, 13, 14, 6, 9, 21, ... // infinite
</code></pre>

<p>These example may be silly, but we really want to help people grok just how effective mechanisms are as a programming construct and abstraction.</p>

<h2 id="what-problems-are-we-solving">What Problems Are We Solving</h2>

<p>// TODO</p>

<h2 id="why-mechanisms-feel-right">Why Mechanisms Feel Right</h2>

<p>// TODO</p>

<p>If you find mechanisms interesting, please follow <a href="http://www.twitter.com/erichosick">@erichosick</a>.</p>


      <hr>
      <div class="pagination pagination-centered">
        <ul>
        
          <li class="prev"><a href="/design/design-mechanisms-and-policies" title="Mechanisms">&larr; Previous</a></li>
        
          <li><a href="/archive.html">Archive</a></li>
        
          <li class="next disabled"><a>Next &rarr;</a>
        
        </ul>
      </div>    
      <hr>
      <div>
        


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'erichosickblog'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




      </div>

    </div>    
  </div>
</div>



      <hr>
      <footer>
         <p>&copy; <a href="http://www.twitter.com/erichosick" target="_blank">Eric Hosick</a> 2012</p>
       </footer>
    </div>    
    <!--

    <script src="/assets/js/jquery.js"></script>
    <script src="/assets/js/bootstrap-transition.js"></script>
    <script src="/assets/js/bootstrap-alert.js"></script>
    <script src="/assets/js/bootstrap-modal.js"></script>
    <script src="/assets/js/bootstrap-dropdown.js"></script>
    <script src="/assets/js/bootstrap-scrollspy.js"></script>
    <script src="/assets/js/bootstrap-tab.js"></script>
    <script src="/assets/js/bootstrap-tooltip.js"></script>
    <script src="/assets/js/bootstrap-popover.js"></script>
    <script src="/assets/js/bootstrap-button.js"></script>
    <script src="/assets/js/bootstrap-collapse.js"></script>
    <script src="/assets/js/bootstrap-carousel.js"></script>
    <script src="/assets/js/bootstrap-typeahead.js"></script>
    
    -->

    
  </body>
</html>

