
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Mechanisms and Maps With Javascript</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Maps are implement using emitters.">
    <meta name="author" content="Eric Hosick">

    <meta property="og:title" content="Eric Hosick" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="http://www.erichosick.com/assets/img/eric_hosick.jpg"/> 
    <meta property="og:description" content="Eric Hosick's personal blog page and stuff."/>
    <meta property="fb:admins" content="erichosick" />

    <link href='//netdna.bootstrapcdn.com/twitter-bootstrap/2.1.1/css/bootstrap-combined.min.css' rel='stylesheet'>    
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="http://fonts.googleapis.com/css?family=Pontano+Sans" rel="stylesheet" type="text/css">

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>


    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="http://www.erichosick.com"><img src="/assets/img/logoRuby.png"></img></a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li><a href="/index.html">Home</a></li>
              <li><a href="/categories.html">Categories</a></li>
              <li><a href="/pages.html">Pages</a></li>
              <li><a href="/tags.html">Tags</a></li>
            </ul>
            <p class="pull-right">
              <a class="nav-a-social" href="https://plus.google.com/101227313031284036080/posts" target="_blank"><i class="icon-google-color icon-social"></i></a>
              <a class="nav-a-social" href="http://www.twitter.com/erichosick" target="_blank"><i class="icon-twitter-color icon-social"></i></a>
              <a class="nav-a-social" href="mailto:erichosick@gmail.com"><i class="icon-mail-color icon-social"></i></a>
            </p>
          </div>
        </div>
      </div>
    </div>    

    <div class="container-fluid container-main">
      
<div class="row-fluid">
  <div class="span3">
    <div class="well sidebar-nav">
  <ul class="nav nav-list">
    <li class="nav-header">About</li>
    <li><img src="/assets/img/eric_hosick.jpg" class="img-rounded"></li>
    <li> <a href="http://www.erichosick.com">Eric Hosick</a><p class="nav-about">Creator of Interface Vision, NoMethods, Agile enthusiast, entrepreneur, founder, BDD advocate, lecturer, technologist, developer, scrum master and book writer.</p></li>
    <li><p><a href="http://twitter.com/erichosick" target="_blank">erichosick@gmail.com</a></p></li>
  </ul>
</div>

    
    <div class="well sidebar-nav">
      <ul class="nav nav-list">
        <li class="nav-header">Tags</li>
        
        


  
     
    	<li><a href="/tags.html#Javascript-ref">Javascript <span>3</span></a></li>
     
    	<li><a href="/tags.html#composition-ref">composition <span>6</span></a></li>
     
    	<li><a href="/tags.html#mechanisms-ref">mechanisms <span>3</span></a></li>
     
    	<li><a href="/tags.html#policy-ref">policy <span>2</span></a></li>
     
    	<li><a href="/tags.html#frameworks-ref">frameworks <span>2</span></a></li>
     
    	<li><a href="/tags.html#programming languages-ref">programming languages <span>2</span></a></li>
     
    	<li><a href="/tags.html#maps-ref">maps <span>1</span></a></li>
     
    	<li><a href="/tags.html#emitters-ref">emitters <span>1</span></a></li>
     
    	<li><a href="/tags.html#emit-ref">emit <span>1</span></a></li>
    
  



      </ul>
    </div><!--/.well -->
      
    
  </div>
  <div class="span9">
    <div class="hero-unit">
      <div class="page-header">
        <h1>Mechanisms and Maps With Javascript</h1>
        <div class="row-fluid">
          <div class="span2">
            <img src="/assets/img/eric_hosick.jpg" class="img-rounded">
          </div>
          <div class="span8">
            <p>by <a href="http://twitter.com/erichosick" target="_blank">Eric Hosick</a> (erichosick@gmail.com)</p>
            <h4>Published <small class="date">15 October 2014</small></h4>
          </div>
        </div>
      </div>
      <script src="/assets/js/mech/mech-core.js"></script>

<script src="/assets/js/mech/mech-math.js"></script>

<script src="/assets/js/mech/mech-emit.js"></script>

<script src="/assets/js/mech/mech-guid.js"></script>

<script src="/assets/js/mech/mech-math.js"></script>

<script src="/assets/js/mech/mech-web.js"></script>

<h2 id="introduction">Introduction</h2>

<p>Mechanisms give programmers more flexible ways to use mapping algorithms in their programs (see our prior post on what <a href="/design/design-mechanisms-and-policies" title="mechanisms and policies">mechanisms and policies</a> are).</p>

<blockquote>
  <p>Hay! Mechanisms like emitters and maps are not coupled to any framework. You can use them in your Javascript programs by ‘npm installing’ small npms like <a href="https://www.npmjs.org/package/mech-emit">emitters</a> and <a href="https://www.npmjs.org/package/mech-math" title="NPM of math mechanism">maps</a>.</p>
</blockquote>

<p>In this post, we will show how we can implement <a href="https://github.com/mechanismsjs/mech-math#map-mechanism" title="The map mechanism">mapping</a> using <a href="/design/design-mechanisms-and-policies" title="mechanisms and policies">mechanisms</a> and <a href="https://github.com/mechanismsjs/mech-emit" title="Mechanisms for emitting data">emitters</a>.</p>

<p>Let’s map the addition of two emitters limited to the number of elements <strong>you</strong> enter (as long as it is less than 100,001):</p>

<pre><code>m.map(
  m.add (
    m.emitFromRange(0, Infinity, 2), // positive integers
    m.emitFromRange(1, Infinity, 2)  // negative integers
  ),
  m.min(
    m.propGet("value", m.elemById("inp05")),
    100000
  )
);

// Quick Documentation:
// m.map(algorithm, max) - Invokes the algorithm up to max number of times.
// m.add(left, right) - add left to right.
// m.min(arg1, arg2 ... argN) - find min of arg1, arg2 ... argN.
// m.emitFromRange(min,max,by) - On each invocation, emit an element starting at min upto max intcremented-by by.
// m.propGet(prop,item) - return the value located in item.prop.
// m.elemById(id) - return the dom element with id.
</code></pre>

<p>Try it out:</p>

<form id="ex05">
  <textarea id="lst05" rows="4"></textarea><br />
  <input id="inp05" value="30" />&nbsp;enter maximum number of elements to map<br />
  <input id="btn05" type="button" value="Press Me" onclick="
    m.propSet(&quot;value&quot;,
      m.elemById(&quot;lst05&quot;),
      m.map(
        m.add (
          m.emitFromRange(0, Infinity, 2),
          m.emitFromRange(1, Infinity, 2)
        ),
        m.min(m.propGet(&quot;value&quot;, m.elemById(&quot;inp05&quot;)),100000)
      )
    ).go
    " />
</form>

<p>Go to the console (in chrome: View-&gt;Developer-&gt;Javascript Console) and checkout the mechanisms library m: just type m return to see what is available).</p>

<h2 id="map-examples">Map Examples</h2>

<p>Mapping “calls a defined callback function on each element of an array, and returns an array that contains the results”.</p>

<p>Traditionally, this is done in Javascript as follows:</p>

<pre><code>// traditional javascript
var x = [1, 2, 3, 4, 5, 12, 15].map(
   function(number) {
     return number + 2;
   }
);

// x contains [3, 4, 5, 6, 7, 14, 17]
</code></pre>

<p>Map is <strong>pushing</strong> data into the call-back function’s <em>number</em> parameter and <strong>pulling</strong> a result from the call-back function all the while aggregating the results into an array.</p>

<p>Let’s build a program that does the same thing using a <strong>map</strong> and an <strong>emitter</strong> described in detail below.</p>

<pre><code>// mapping defined with mechanisms
var x = m.map(
  m.add(2, m.emitFromArr([1, 2, 3, 4, 5, 12, 15]) )
);

x.go; // run the program
</code></pre>

<p>Try it out:</p>

<form id="ex01">
  <textarea id="lst01" rows="4"></textarea><br />
  <input id="btn01" type="button" value="Press Me" onclick="
    m.propSet(&quot;value&quot;,
      m.elemById(&quot;lst01&quot;),
      m.map(
        m.add(2, m.emitFromArr([1, 2, 3, 4, 5, 12, 15]) )
      )
    ).go
    " />
</form>

<p>Instead of <strong>pushing</strong> values into a call-back function, we <strong>pull</strong> the result of the <em>add</em> algorithm. The difference is subtle but gives programmers more flexibility with their programs while providing a consistent looking programming syntax.</p>

<h2 id="basic-example-of-maps-and-emitters">Basic Example Of Maps and Emitters</h2>

<p>Maybe we just want to <strong>pull</strong> directly from the emitter:</p>

<pre><code>m.map(
  m.emitFromArr([1, 2, 3, 4, 5])
);
</code></pre>

<p>Try it out:</p>

<form id="ex02">
  <textarea id="lst02" rows="4"></textarea><br />
  <input id="btn02" type="button" value="Press Me" onclick="
    m.propSet(&quot;value&quot;,
      m.elemById(&quot;lst02&quot;),
      m.map(
        m.emitFromArr([1, 2, 3, 4, 5])
      )
    ).go
    " />
</form>

<p>Write each element as an equation (we are invoking multiply as a string) to the console as they are being mapped (open the console to see the results):</p>

<pre><code>m.map(
  m.writeLn(
    m.mul(3, m.emitFromRange(1, 3, 1))
  ), 5
);
</code></pre>

<p>Try it out:</p>

<form id="ex03">
  <textarea id="lst03" rows="4"></textarea><br />
  <input id="btn03" type="button" value="Press Me" onclick="
    m.propSet(&quot;value&quot;,
      m.elemById(&quot;lst03&quot;),
      m.map(
        m.writeLn(
          m.mul(3, m.emitFromRange(1, 3, .5))
        ), 5
      )
    ).go
    " />
</form>

<p>We can even map a literal:</p>

<pre><code>m.map(4,25);
</code></pre>

<p>Try it out:</p>

<form id="ex04">
  <textarea id="lst04" rows="4"></textarea><br />
  <input id="btn04" type="button" value="Press Me" onclick="
    m.propSet(&quot;value&quot;,
      m.elemById(&quot;lst04&quot;),
      m.map(4,25)
    ).go
    " />
</form>

<p>There is added flexibility for the programmer because we can map more than just a call-back function.</p>

<h3 id="implementation">Implementation</h3>

<p>The map mechanism itself is simple and the <a href="https://github.com/mechanismsjs/mech-math/blob/master/src/map.js">implementation</a> is partially provided here:</p>

<pre><code>MapF.prototype = Object.create(Object.prototype, {
  go: { get: function() {
    if ( null === this._cache) {
       var algo = this._a;
       var isMechanism = algo.isMech;
       this._cache = [];
       var cur = isMechanism ? algo.go : algo;
       var i = 0;
       while ((undefined !== cur) &amp;&amp; ( i &lt; this._fixed)) {
          this._cache[i++] = cur;
          cur = isMechanism ? algo.go : algo;
       }
    }
    return this._cache;
  }}
});
</code></pre>

<p>We simply <strong>pull</strong> a result from the algorithm located in <em>this._a</em>, invoking the program by accessing go, and insert it into an array.</p>

<h2 id="more-examples-of-mapping-with-emitter-mechanisms">More Examples of Mapping with Emitter Mechanisms</h2>

<p>An <a href="https://github.com/mechanismsjs/mech-emit" title="Mechanisms for emitting data">emitter</a> provides the next item from… something. We have created two emitter mechanisms so far:</p>

<ul>
  <li><strong>emitFromArr</strong> - An emitter that pulls items from an array.</li>
  <li><strong>emitFromRange</strong> - An emitter that pulls items from a dynamically generated range of numbers.</li>
</ul>

<p>We can do some cool things with these.</p>

<p>How about:</p>

<pre><code>m.emitFromRange(0, Infinity, 23); // an unlimited range
m.emitFromRange(-20, 20, .5); // a simple range
m.emitFromRange(1, Infinity, 2); // emit odd numbers
m.emitFromRange(0, Infinity, 2); // emit even numbers
</code></pre>

<p>How about a range that repeats:</p>

<pre><code>m.emitFromRange(1,3,1,true); // an unlimited range [1,2,3,1,2,3...]
</code></pre>

<p>Let’s add two emitters (the above example):</p>

<pre><code>m.add(
  m.emitFromRange(0, Infinity, 2),
  m.emitFromRange(1, Infinity, 2)
);
</code></pre>

<p>or subtract two emitters:</p>

<pre><code>var x = m.sub(
  m.emitFromRange(0, Infinity, 2),
  m.emitFromRange(1, Infinity, 2)
);

x.go;

// kinda boring: try it in the console.
</code></pre>

<h2 id="maps-of-unlimited-length">Maps of Unlimited Length?</h2>

<p>Emitters are mechanisms that do mapping without placing the results in an array. This added flexibility means we can place emitters anywhere within our program without first mapping them. This effectively allows us to have maps of unlimited length.</p>

<h2 id="how-flexible-are-mechanisms">How Flexible Are Mechanisms?</h2>

<p>The programs we build out of mechanisms can be used in any property of another mechanism.</p>

<p>Check this out:</p>

<pre><code>m.propSet("value",
  m.elemById("lst06B"),
  m.emitFromRange( 1, Infinity,
    m.propSet("value",
      m.elemById("lst06A"),
      m.emitFromArr([1,-8,3,12], true)
    )
  )
);
</code></pre>

<p>Try it out:</p>

<script>
var weirdEmitter =
  m.propSet("value",
    m.elemById("lst06B"),
    m.emitFromRange( 1, Infinity,
      m.propSet("value",
        m.elemById("lst06A"),
        m.emitFromArr([1,-8,3,12], true)
      )
    )
  );
</script>

<form id="ex06">
  <input id="lst06A" />&nbsp;value of 'by'<br />
  <input id="lst06B" />&nbsp;value of emitter<br />
  <input id="btn06" type="button" value="Press Me A Lot Of Times" onclick="weirdEmitter.go;" />
</form>

<p>Each time you press the button, the next value is pulled from the ‘by’ property. The <em>increment-by</em> for the emitFromRange emitter changes on each emission because <em>increment-by</em> is itself an emitter encapsulated in small program to write that emitted value to an input field.</p>

<p>We are effectively able to ‘observe’ what is going on by ‘injecting’ that small program between the emitFromRange emitter and the emitFromArr emitter.</p>

<p>Mechanisms are really flexible and we think programmers are really going to value this flexibility.</p>

<h2 id="conclusion">Conclusion</h2>

<p>We’ve shown a few interesting characteristics of mechanisms. One characteristic is that mechansism give programmers <strong>a lot</strong> of flexibility in what they can do at <strong>any point</strong> in their program. In our examples, we see that we are able to use only mechanisms to provide a highly flexible way to describe mapping. </p>

<p>Another characteristic is that we are able to provide a consistent programming syntax for describing how to do something. In our examples, we are able to see that the syntax is consistent because we don’t need to describe call-back functions, variables and scope (the {} around the function) within our syntax.</p>

<p>And as always, a characteristics of mechanisms is that they are <strong>framework agnostic</strong>. You can use any of these mechanism libraries independently of each other in any other framework: <a href="https://www.npmjs.org/package/mech-emit" title="NPM of mechanisms for emitting data">emitters</a>, <a href="https://www.npmjs.org/package/mech-guid" title="NPM of mechanisms for guids">guids</a>, <a href="https://www.npmjs.org/package/mech-web" title="NPM of web centric DOM mechanisms">web</a>, <a href="https://www.npmjs.org/package/mech-math" title="NPM of math mechanism">math</a> and <a href="https://www.npmjs.org/package/mech-core" title="NPM of core mechanisms">core</a>.</p>

<p>If you find mechanisms interesting, please follow <a href="http://www.twitter.com/erichosick">@erichosick</a>.</p>


      <hr>
      <div class="pagination pagination-centered">
        <ul>
        
          <li class="prev"><a href="/design/design-mechanisms-and-policies" title="Mechanisms">&larr; Previous</a></li>
        
          <li><a href="/archive.html">Archive</a></li>
        
          <li class="next disabled"><a>Next &rarr;</a>
        
        </ul>
      </div>    
      <hr>
      <div>
        


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'erichosickblog'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




      </div>

    </div>    
  </div>
</div>



      <hr>
      <footer>
         <p>&copy; <a href="http://www.twitter.com/erichosick" target="_blank">Eric Hosick</a> 2012</p>
       </footer>
    </div>    
    <!--

    <script src="/assets/js/jquery.js"></script>
    <script src="/assets/js/bootstrap-transition.js"></script>
    <script src="/assets/js/bootstrap-alert.js"></script>
    <script src="/assets/js/bootstrap-modal.js"></script>
    <script src="/assets/js/bootstrap-dropdown.js"></script>
    <script src="/assets/js/bootstrap-scrollspy.js"></script>
    <script src="/assets/js/bootstrap-tab.js"></script>
    <script src="/assets/js/bootstrap-tooltip.js"></script>
    <script src="/assets/js/bootstrap-popover.js"></script>
    <script src="/assets/js/bootstrap-button.js"></script>
    <script src="/assets/js/bootstrap-collapse.js"></script>
    <script src="/assets/js/bootstrap-carousel.js"></script>
    <script src="/assets/js/bootstrap-typeahead.js"></script>
    
    -->

    
  </body>
</html>

